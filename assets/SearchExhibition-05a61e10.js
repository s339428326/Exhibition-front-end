import{_ as N,r as x,e as G,u as J,a as X,w as R,o as Y,b as $,c as v,d as f,f as t,g as m,F as H,h as K,t as d,n as D,i as z,j as U,p as Z,k as ee,l as te,m as ae,q as Q,R as O}from"./index-d614a8a0.js";const P=h=>(Z("data-v-80c782ec"),h=h(),ee(),h),le={class:"w-100 mb-2 d-block d-md-none"},oe=P(()=>t("span",null," Close",-1)),se=["checked"],ne=P(()=>t("p",{for:"date-valid",class:"pb-1"}," 顯示已結束展覽 ",-1)),re={class:"mb-3"},ce=P(()=>t("p",{class:"fw-bold mb-2"},"類型",-1)),ie={class:"type-list rounded-3 border mb-1"},de={class:"border-bottom p-2"},ue=["checked"],pe=P(()=>t("span",{for:"type-all"},"全部",-1)),ve=["onClick"],ye=["id","value","checked"],be=["for"],he={class:"d-flex px-1"},_e={class:"mb-2"},fe=P(()=>t("p",{class:"fw-bold mb-2"},"展覽期間",-1)),me=P(()=>t("p",{class:"mb-2 fw-bold"},"價格",-1)),ge={class:"d-flex flex-column"},xe=P(()=>t("p",{class:"mb-1 fs-7"},"最小票價",-1)),we={key:1,class:"errorMessage"},ke={class:"d-flex flex-column"},De=P(()=>t("p",{class:"mb-1 fs-7"},"最大票價",-1)),$e={key:1,class:"errorMessage"},Pe={class:"fs-7 mb-2 fw-bold"},Ve={class:"city-list border rounded-3"},Se={class:"p-2 border-bottom"},Ce=["checked"],qe=P(()=>t("span",{for:"all"},"全部",-1)),Le=["onClick"],Ie=["id","value","checked"],Ee=["for"],Fe={__name:"Filter",props:{isFilterShow:Boolean,filterShowHandler:Function,resetKeyName:String},emits:["reset"],setup(h,{emit:p}){const _=h,W=["臺北","新北","桃園","臺中","臺南","高雄","新竹","苗栗","彰化","南投","雲林","嘉義","屏東","宜蘭","花蓮","臺東","澎湖","金門","連江","基隆"],c=x({typeArr:[],cityArr:W,cityKeyWord:"",typeQuantity:5}),w=x(G()),V=J(),g=X(),a=x({dateValid:!1,type:"all",startDate:0,endDate:0,minPrice:0,maxPrice:1e5,city:"all"});R(_,()=>{switch(_.resetKeyName){case"dateValid":a.value.dateValid=!1,p("reset","all");break;case"type":a.value.type="all",p("reset","all");break;case"startDate":console.log("startDate"),a.value.startDate=0,p("reset","all");break;case"endDate":console.log("endDate"),a.value.endDate=0,p("reset","all");break;case"minPrice":console.log("minPrice"),a.value.minPrice=0,p("reset","all");break;case"maxPrice":console.log("maxPrice"),a.value.maxPrice=1e5,p("reset","all");break;case"city":console.log("city"),a.value.city="all",p("reset","all");break}});const j=r=>{r.preventDefault()};Y(async()=>{w.value.exhibitionList.length===0&&await w.value.getAllExhibitionData(),T(),console.log("[BeforeMount]",w.value.exhibitionList),console.log("[BeforeMount]",V.query),R(a.value,r=>{typeof a.value.startDate=="object"&&(a.value.startDate=new Date(a.value.startDate).getTime()),typeof a.value.endDate=="object"&&(a.value.endDate=new Date(a.value.endDate).getTime()),g.replace({name:"SearchExhibition",query:{...V.query,...a.value}})})});const T=()=>{if(c.value.typeArr=Array.from(new Set(w.value.exhibitionList.map(r=>r.type))),Object.keys(V.query).length>0){const{dateValid:r,type:o,startDate:A,endDate:q,minPrice:L,maxPrice:I,city:F}=V.query,e={dateValid:r==="true",type:o,startDate:parseInt(A),endDate:parseInt(q),minPrice:parseInt(L),maxPrice:parseInt(I),city:F};a.value={...a.value,...e}}},S=(r,o)=>{console.log("click",r,o),a.value[`${r}`]=o,console.log("[fetch Data]",123)},E=r=>{r.preventDefault(),c.value.cityKeyWord=r.target.value,r.target.value===""&&(c.value.cityArr=W),console.log(c.value.cityArr.filter(o=>o.includes(r.target.value))),c.value.cityArr=W.filter(o=>o.includes(r.target.value))},k=r=>{switch(r){case"add":c.value.typeQuantity+=5;break;case"reset":c.value.typeQuantity=5;break}};return(r,o)=>{const A=$("CloseIcon"),q=$("DatePicker"),L=$("VeeField"),I=$("ErrorMessage"),F=$("VeeForm");return v(),f("div",{class:D(`side border-end ${h.isFilterShow?"w-0":"border-none"}`)},[t("div",{class:D(`menu m-4 ${h.isFilterShow&&"d-none"}`)},[t("div",le,[t("button",{class:"btn border",onClick:o[0]||(o[0]=(...e)=>h.filterShowHandler&&h.filterShowHandler(...e))},[m(A),oe])]),t("div",{onClick:o[1]||(o[1]=e=>S("dateValid",!a.value.dateValid)),class:"d-flex gap-2 align-items-center border-bottom pb-4 mb-4 px-3"},[t("input",{id:"date-valid",type:"checkbox",name:"checkbox",checked:a.value.dateValid},null,8,se),ne]),t("div",re,[ce,t("ul",ie,[t("li",de,[t("div",{onClick:o[2]||(o[2]=e=>S("type","all"))},[t("input",{class:"me-2",id:"type-all",type:"radio",name:"type",value:"all",checked:a.value.type==="all"},null,8,ue),pe])]),(v(!0),f(H,null,K(c.value.typeArr.slice(0,c.value.typeQuantity),(e,n)=>(v(),f("li",{class:"p-2 border-bottom",key:n},[t("div",{onClick:u=>S("type",e)},[t("input",{class:"me-2",id:e,type:"radio",name:"type",value:e,checked:a.value.type===e},null,8,ye),t("span",{class:"",for:e},d(e),9,be)],8,ve)]))),128))]),t("div",he,[t("button",{class:D(`border-0 bg-transparent fw-bold ${c.value.typeQuantity<6&&"d-none"}`),type:"button",onClick:o[3]||(o[3]=e=>k("reset"))}," 收回 ",2),t("button",{onClick:o[4]||(o[4]=e=>k("add")),class:D(`border-0 bg-transparent fw-bold ms-auto ${c.value.typeArr.length<5&&"d-none"}`),type:"button"}," 顯示更多 ",2)])]),t("div",_e,[fe,m(q,{modelValue:a.value.startDate,"onUpdate:modelValue":o[5]||(o[5]=e=>a.value.startDate=e),class:"mb-2",type:"number",placeholder:"開始時間"},null,8,["modelValue"]),m(q,{placeholder:"結束時間",modelValue:a.value.endDate,"onUpdate:modelValue":o[6]||(o[6]=e=>a.value.endDate=e)},null,8,["modelValue"])]),me,m(F,{onSubmit:j},{default:z(({errors:e})=>[t("div",ge,[xe,m(L,{modelValue:a.value.minPrice,"onUpdate:modelValue":o[7]||(o[7]=n=>a.value.minPrice=n),class:D(`border rounded py-1 px-2 ${e.最小價格?"border-danger":"border"}`),placeholder:"最小價格",name:"最小價格",type:"number",oninput:"value=value.replace(/[^\\d]/g,'')",rules:{min_value:0,max_value:a.value.maxPrice,numeric:!0}},null,8,["modelValue","class","rules"]),e.最小價格?(v(),U(I,{key:0,as:"p",class:"text-danger errorMessage",name:"最小價格"})):(v(),f("p",we))]),t("div",ke,[De,m(L,{modelValue:a.value.maxPrice,"onUpdate:modelValue":o[8]||(o[8]=n=>a.value.maxPrice=n),class:D(`border rounded py-1 px-2 ${e.最大價格?"border-danger":"border"}`),placeholder:"最大價格",name:"最大價格",type:"number",max:"100000",oninput:"value=value.replace(/[^\\d]/g,'')",rules:{min_value:a.value.minPrice,max_value:1e5,numeric:!0}},null,8,["modelValue","class","rules"]),e.最大價格?(v(),U(I,{key:0,as:"p",class:"text-danger errorMessage",name:"最大價格"})):(v(),f("p",$e))])]),_:1}),t("div",null,[t("p",Pe,"城市 "+d(c.value.cityKeyWord),1),t("input",{onInput:E,class:"border w-100 rounded px-2 py-1 mb-2",type:"search",placeholder:"篩選城市名稱",name:"cityKeyWord",id:"cityKeyWord"},null,32),t("ul",Ve,[t("li",Se,[t("div",{onClick:o[9]||(o[9]=e=>S("city","all"))},[t("input",{class:"me-2",id:"all",type:"radio",name:"city",value:"all",checked:a.value.city==="all"},null,8,Ce),qe])]),(v(!0),f(H,null,K(c.value.cityArr,(e,n)=>(v(),f("li",{class:"p-2 border-bottom",key:n},[t("div",{onClick:u=>S("city",e)},[t("input",{class:"me-2",id:e,type:"radio",name:"city",value:e,checked:a.value.city===e},null,8,Ie),t("span",{class:"",for:e},d(e),9,Ee)],8,Le)]))),128))])])],2)],2)}}},Me=N(Fe,[["__scopeId","data-v-80c782ec"]]);const M=h=>(Z("data-v-3e0de330"),h=h(),ee(),h),We={class:"d-flex"},Ae={class:"container position-relative px-3"},He={class:"mt-5 rounded-3"},Ke=M(()=>t("h1",{class:"fw-bold font-pathway fs-4"},"展覽檢索",-1)),je=M(()=>t("p",{class:"font-pathway fw-bold fs-3 mb-2"},"Exhibition Search",-1)),Be={class:"d-flex flex-wrap gap-4 mb-2 border p-3 rounded-3 border-dark"},Qe=M(()=>t("span",null," 篩選器",-1)),Re={class:"d-flex flex-column gap-1 flex-grow-1 justify-content-center"},Te={class:"d-flex gap-2 mb-4"},ze=["onClick"],Ue={class:""},Oe={class:"mb-2"},Ne={class:"fs-7"},Ge={class:"row"},Je={class:"border position-relative shadow rounded-3 overflow-hidden"},Xe={class:"position-absolute bg-secondary text-white px-3 py-2 border-bottom-end-3"},Ye=["src","alt"],Ze={class:"p-3"},et={class:"card-title fw-bold"},tt={class:"d-flex gap-2 mb-1"},at=M(()=>t("span",null,"~",-1)),lt={class:"d-flex"},ot={class:"border py-1 px-2 bg-success text-white rounded-pill fs-7"},st={class:"d-flex justify-content-center gap-1 mt-5 mb-5"},nt=M(()=>t("span",null,"返回",-1)),rt={class:"pagination d-flex gap-1"},ct=["onClick"],it=M(()=>t("span",null,"更多",-1)),dt={__name:"SearchExhibition",setup(h){const p=G(),_=J(),W=X(),c=x(""),w=x(),V=x(""),g=x([...p.exhibitionList]),a=x({nextBtnDisable:!1,counter:0,pageView:3,limit:8,currentPage:1}),j=x([]),T=e=>{a.value.currentPage=e},S=e=>{const n=g.value.length%a.value.limit>0?1:0,u=Math.floor(g.value.length/a.value.limit)+n,s=Math.ceil(u/a.value.pageView);switch(e){case"next":if(a.value.counter+1>=s)return;console.log(a.value.counter,s),a.value.counter++,a.value.currentPage=a.value.counter*a.value.pageView+1;break;case"pre":if(a.value.counter===0)return;a.value.counter--,a.value.currentPage=a.value.counter*a.value.pageView+1;break}},E=()=>{j.value=Array.from(Array(Math.ceil(g.value.length/a.value.limit)).keys()).slice(a.value.counter*a.value.pageView,(a.value.counter+1)*a.value.pageView)},k=x(!1),r=()=>{k.value=!k.value,k.value===!1?window.matchMedia("(min-width:768px)").matches===!1&&(document.querySelector("body").style="overflow:hidden"):document.querySelector("body").style=null},o=()=>{V.value=""},A=e=>{V.value=e},q=e=>{const{city:n,dateValid:u,startDate:s,endDate:i,maxPrice:B,minPrice:l,type:y}=e,b={dateValid:u==="false"?null:u,city:n==="all"?null:n,startDate:s!=="0"&&s!==void 0?parseInt(s):null,endDate:i!=="0"&&i!==void 0?parseInt(i):null,maxPrice:B==="100000"?null:parseInt(B),minPrice:l==="0"?null:parseInt(l),type:y==="all"?null:y};Object.keys(b).forEach(C=>{(b[C]===null||b[C]===void 0)&&delete b[C],(C==="maxPrice"||C==="minPrice")&&isNaN(b[C])&&delete b[C]}),(b.maxPrice<b.minPrice||b.maxPrice>1e5)&&(delete b.maxPrice,delete b.minPrice),E(),w.value={...b}},L=te.debounce(e=>{c.value=e.target.value,W.replace({name:"SearchExhibition",query:{..._.query,keyWord:c.value}})},300),I=()=>{console.log("[filterExhList start]",w.value);let e=[...p.exhibitionList];const n=w.value;e=e.filter(u=>u.endDate>new Date().getTime()),Object.keys(n).map(u=>u).length===0&&console.log("全部展示"),Object.entries(n).forEach(([u,s])=>{switch(console.log(u,s),u){case"dateValid":if(e=e.filter(i=>i.endDate>new Date().getTime()),s===!1)return;e=[...p.exhibitionList],console.log("篩選中-1:dateValid",e);break;case"city":if(s==="all")return;e=e.filter(i=>i.location.country===s),console.log("篩選中-2:city",e);break;case"startDate":if(s===0)return;e=e.filter(i=>i.startDate>=s),console.log("篩選中-3:startDate",e);break;case"endDate":if(s===0)return;e=e.filter(i=>i.endDate<=s);break;case"maxPrice":if(s===0)return;e=e.filter(i=>i.maxPrice>=s);break;case"minPrice":if(s===0)return;e=e.filter(i=>i.minPice<=s);break;case"type":if(s==="all")return;e=e.filter(i=>i.type===s)}}),_.query.keyWord!==""&&_.query.keyWord&&(console.log(_.query.keyWord),e=e.filter(u=>u.name.includes(_.query.keyWord)),console.log("search",e)),g.value=e,console.log("[filterExhlist] result:",g.value)},F=()=>{const e=window.matchMedia("(max-width:768px)");console.log(e),e.matches===!0&&(k.value=!0,document.querySelector("body").style=null),e.matches===!1&&(document.querySelector("body").style=null),e.matches===!0&&k.value===!1?document.querySelector("body").style="overflow:hidden":document.querySelector("body").style=null};return Y(async()=>{p.exhibitionList.length===0&&await p.getAllExhibitionData(),q(_.query),_.query.keyWord&&(document.querySelector(".search-keyword").value=_.query.keyWord,c.value=_.query.keyWord),g.value=p==null?void 0:p.exhibitionList.filter(e=>e.endDate>new Date().getTime()),I(),E(),R(a.value,()=>{E()}),window.addEventListener("resize",F)}),ae(()=>{window.removeEventListener("resize",F),document.querySelector("body").style=null}),R(_,()=>{q(_.query),I(),a.value.counter=0,a.value.currentPage=1,E()}),(e,n)=>{const u=$("FilterMenu"),s=$("CloseIcon"),i=$("ChevronLeft"),B=$("ChevronRight");return v(),f("div",We,[m(Me,{"is-filter-show":k.value,"filter-show-handler":r,resetKeyName:V.value,onReset:o},null,8,["is-filter-show","resetKeyName"]),t("div",Ae,[t("div",He,[Ke,je,t("div",Be,[t("button",{class:"btn btn-primary fs-7 d-flex flex-wrap justify-content-center",type:"button",onClick:r},[m(u),Qe]),t("div",Re,[t("input",{onInput:n[0]||(n[0]=(...l)=>Q(L)&&Q(L)(...l)),class:"search-keyword border rounded-1 px-2 py-1",type:"search",placeholder:"輸入展覽名稱"},null,32)])]),t("div",Te,[(v(!0),f(H,null,K(w.value,(l,y,b)=>(v(),f("div",{class:"d-flex gap-2 align-items-center fs-7 border bg-transparent p-1 rounded",key:b},[t("button",{class:"p-0 border-0 bg-transparent",onClick:C=>A(y)},[m(s,{size:18})],8,ze),t("p",Ue,d(`${y==="dateValid"?"顯示結束展覽":""}`)+" "+d(`${y==="startDate"?`始於 ${new Date(l).toLocaleDateString()}`:""}`)+" "+d(`${y==="endDate"?`結束 ${new Date(l).toLocaleDateString()}`:""}`)+" "+d(`${y==="type"?`類別 ${l}`:""}`)+" "+d(`${y==="minPrice"?`最小價格 ${l}`:""}`)+" "+d(`${y==="maxPrice"?`最大價格 ${l}`:""}`)+" "+d(`${y==="city"?`城市 ${l}`:""}`),1)]))),128))]),t("div",Oe,[t("p",{class:D(`fs-7 ${!c.value.length>0&&"d-none"}`)}," 搜索關鍵字："+d(c.value),3),t("p",Ne,"總搜索筆數("+d(g.value.length)+")",1)])]),t("div",Ge,[(v(!0),f(H,null,K(g.value.slice(a.value.limit*(a.value.currentPage-1),a.value.limit*a.value.currentPage),(l,y)=>(v(),f("div",{key:y,class:"col-12 col-md-6 col-lg-4 col-xl-3 mb-4"},[t("div",Je,[t("div",Xe,d(l==null?void 0:l.location.country),1),m(Q(O),{class:"text-dark rounded",to:`viewExhibition/${l==null?void 0:l.id}`},{default:z(()=>[t("img",{class:"image-box hover-scale",src:l==null?void 0:l.image,alt:l.name},null,8,Ye)]),_:2},1032,["to"]),t("div",Ze,[t("div",et,[m(Q(O),{class:"text-dark",to:`viewExhibition/${l==null?void 0:l.id}`},{default:z(()=>[t("p",null,d(l==null?void 0:l.name),1)]),_:2},1032,["to"])]),t("div",tt,[t("span",null,d(new Date(l==null?void 0:l.startDate).toLocaleDateString()),1),at,t("span",null,d(new Date(l==null?void 0:l.endDate).toLocaleDateString()),1)]),t("ul",lt,[t("li",ot,d(l==null?void 0:l.type),1)])])])]))),128))]),t("nav",st,[t("button",{onClick:n[1]||(n[1]=l=>S("pre")),class:"p-1 border border-1 rounded bg-transparent"},[m(i),nt]),t("ul",rt,[(v(!0),f(H,null,K(j.value,(l,y)=>(v(),f("li",{onClick:b=>T(l+1),key:y,class:D(`border p-2 rounded ${a.value.currentPage===l+1&&" bg-primary text-white"}`)},[t("button",{class:D(`border-0 bg-transparent ${a.value.currentPage===l+1&&"  text-white"}`)},d(l+1),3)],10,ct))),128))]),t("button",{onClick:n[2]||(n[2]=l=>S("next")),class:"p-1 border border-1 rounded bg-transparent"},[m(B),it])])])])}}},pt=N(dt,[["__scopeId","data-v-3e0de330"]]);export{pt as default};
